<!DOCTYPE html>
<html lang="en">
<head>
    <%- include('partials/head') %>
    <link rel="stylesheet" href="/css/builder.css">
    <link rel="stylesheet" href="/css/theme.css">
</head>
<body>

    <button id="exitPreviewBtn" onclick="togglePreview()">âŒ Close</button>

    <div class="sidebar">
        <h3>ğŸ’ Invitation Builder</h3>
        
        <div class="section-title">Global Theme</div>
        <select id="themeSelector" onchange="changeTheme(this.value)" style="margin-bottom: 20px; padding: 10px; width: 100%;">
            <option value="">âšª Default (None)</option>
            <option value="modern">ğŸŸ¦ Modern Navy</option>
            <option value="elegant">âœ¨ Elegant Gold</option>
            <option value="ocean">ğŸŒŠ Ocean Blue</option>
        </select>

        <div class="section-title">Structure</div>
        
        <button class="tool-btn" onclick="openSelector('hero')">Header Styles</button>
        <button class="tool-btn" onclick="openSelector('text')">Text Paragraph</button>
        <button class="tool-btn" onclick="openSelector('details')">Date & Location</button>
        <button class="tool-btn" onclick="openSelector('image')">ğŸ“· Add Photo</button>
        <button class="tool-btn" style="border-left: 4px solid #27ae60;" onclick="openSelector('rsvp')">ğŸ’Œ Add RSVP Form</button>
        <button class="tool-btn special-btn" onclick="openSelector('guest')">Add Guest Name</button>
        <button class="tool-btn" style="border-left: 4px solid #e74c3c;" onclick="openMusicSettings()">ğŸµ Background Music</button>
        <button class="tool-btn save-btn" onclick="saveWork()">Save Design</button>
    </div>

    <div class="workspace">
        <button class="workspace-btn preview-toggle" onclick="togglePreview()">ğŸ‘ï¸ Preview</button>

        <div id="canvas" data-theme="<%= locals.preloadTheme || '' %>">
            <% if (locals.preloadDesign) { %>
                <%- preloadDesign %>
            <% } else { %>
                <div style="padding:20px; text-align:center; color:#999; margin-top:50%;">
                    Add blocks from the left to start building...
                </div>
            <% } %>
        </div>
    </div>

    <div class="properties-panel" id="propertiesPanel">
        <h3>ğŸ¨ Edit Style</h3>
        <p class="hint-text">Click a block to edit properties</p>
        
        <div id="commonControls" style="display:none; margin-bottom: 15px; border-bottom: 1px solid #444; padding-bottom: 15px;">
             <div style="display: flex; gap: 10px;">
                <button class="tool-btn" id="moveUpBtn" style="background: #34495e; text-align: center;">â¬†ï¸ Move Up</button>
                <button class="tool-btn" id="moveDownBtn" style="background: #34495e; text-align: center;">â¬‡ï¸ Move Down</button>
             </div>
        </div>

        <div id="imageControls" style="display:none; border-bottom: 1px solid #444; padding-bottom: 20px; margin-bottom: 20px;">
            <label>Change Image</label>
            <p class="hint-text">Upload a photo to replace this image.</p>
            <input type="file" id="imageInput" accept="image/*" style="width: 100%; margin-top: 5px;">
            
            <div class="control-group" style="margin-top: 15px;">
                <label>Width</label>
                <input type="range" id="imgWidthInput" min="10" max="100" value="100">
            </div>
            
            <div class="control-group">
                <label>Border Radius</label>
                <input type="range" id="imgRadiusInput" min="0" max="50" value="0">
            </div>
        </div>

        <div id="musicControls" style="display:none; border-bottom: 1px solid #444; padding-bottom: 20px; margin-bottom: 20px;">
            <label>ğŸµ Ambient Music</label>
            <p class="hint-text">Upload an MP3 or paste a link.</p>
            
            <input type="file" id="musicInput" accept="audio/mp3,audio/mpeg" style="width: 100%; margin-top: 5px;">
            <p style="text-align:center; margin:5px 0;">OR</p>
            <input type="text" id="musicUrlInput" placeholder="https://example.com/song.mp3">
            
            <div id="musicPreview" style="margin-top:10px; color:#27ae60; font-size:0.9em; display:none;">
                âœ… Music Selected
            </div>
        </div>

        <!-- MAP CONTROLS -->
        <div id="mapControls" style="display:none; border-bottom: 1px solid #444; padding-bottom: 20px; margin-bottom: 20px;">
            <label>ğŸ“ Event Location</label>
            
            <!-- Option 1: Address Search -->
            <p class="hint-text" style="margin-top: 5px;">Option 1: Type Address</p>
            <input type="text" id="mapAddressInput" placeholder="e.g. Central Park, NY">
            <button id="updateMapBtn" class="tool-btn" style="margin-top:10px; background:#2980b9;">Update Map</button>
            
            <!-- Option 2: Google Maps Link -->
            <p class="hint-text" style="margin-top: 15px; border-top: 1px dashed #555; padding-top: 10px;">Option 2: Paste Google Maps Link</p>
            <input type="text" id="mapLinkInput" placeholder="Paste link here...">
            <button id="extractMapBtn" class="tool-btn" style="margin-top:10px; background:#27ae60;">Extract & Set Location</button>
        </div>

        <div id="textControls" style="display:none;">
            <div class="control-group">
                <label>Text Color</label>
                <div class="color-input-wrapper">
                    <input type="color" id="colorInput">
                    <span id="colorValue">#000000</span>
                </div>
            </div>

            <div class="control-group">
                <label>Background Color</label>
                <div class="color-input-wrapper">
                    <input type="color" id="bgColorInput">
                    <span id="bgColorValue">#ffffff</span>
                </div>
            </div>

            <div class="control-group" style="border-top: 1px dashed #555; padding-top: 15px; margin-top: 15px;">
                <label>ğŸŒ„ Background Image</label>
                <p class="hint-text">Upload to replace color</p>
                <input type="file" id="bgImageInput" accept="image/*">
                
                <div style="margin-top: 10px; display: flex; align-items: center; gap: 10px;">
                    <input type="checkbox" id="parallaxCheckbox" style="width: auto;">
                    <label for="parallaxCheckbox" style="margin:0; cursor:pointer;">Enable Parallax Effect</label>
                </div>
                
                <button id="removeBgImgBtn" class="tool-btn" style="margin-top: 10px; background: #c0392b; font-size: 0.8em;">Remove Image</button>
            </div>

            <div class="control-group">
                <label>Padding (Space)</label>
                <input type="range" id="paddingInput" min="0" max="60" value="20">
            </div>

            <div class="control-group">
                <label>Alignment</label>
                <div class="btn-group">
                    <button class="align-btn" data-align="left">L</button>
                    <button class="align-btn" data-align="center">C</button>
                    <button class="align-btn" data-align="right">R</button>
                </div>
            </div>

            <div class="control-group">
                <label>Font Size</label>
                <select id="fontSizeInput">
                    <option value="16px">Small</option>
                    <option value="18px">Normal</option>
                    <option value="24px">Medium</option>
                    <option value="32px">Large</option>
                    <option value="48px">Huge</option>
                </select>
            </div>
            
            <div class="control-group" style="margin-top: 20px; border-top: 1px solid #444; padding-top: 10px;">
                <button class="tool-btn delete-btn" id="deleteBlockBtn">ğŸ—‘ï¸ Delete Block</button>
            </div>
        </div>
    </div>

    <div id="templateModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Choose a Style</h2>
                <span class="close-btn" onclick="closeModal()">&times;</span>
            </div>
            <div id="templateGrid" class="template-grid"></div>
        </div>
    </div>

    <div id="saveModal" class="modal-overlay">
        <div class="modal-content" style="text-align: center; max-width: 400px;">
            <div class="modal-header" style="justify-content: center; border: none;">
                <h2 style="margin: 0; color: #27ae60;">ğŸ‰ Invitation Saved!</h2>
            </div>
            
            <p style="color: #666; margin-bottom: 20px;">Your invitation is ready to share.</p>
            
            <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                <input type="text" id="shareUrlInput" readonly style="background: #f4f4f4; border: 1px solid #ddd; color: #555;">
                <button class="tool-btn" id="copyLinkBtn" style="width: auto; padding: 0 20px;">ğŸ“‹ Copy</button>
            </div>

            <div style="display: flex; gap: 10px;">
                <a id="openLinkBtn" href="#" target="_blank" class="tool-btn" style="background: #3498db; text-decoration: none; display: inline-block; line-height: 20px;">ğŸš€ Open</a>
                <button class="tool-btn" onclick="document.getElementById('saveModal').style.display='none'" style="background: #95a5a6;">Close</button>
            </div>
        </div>
    </div>

    <script type="module" src="/js/app.js"></script>
</body>
</html>